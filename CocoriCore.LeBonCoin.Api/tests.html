<html>

<head>
</head>

<body>
    <!--
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Navbar</a>
    </nav>
    -->
    <div class="container">
        <div id='content'>

        </div>
    </div>

    <script>
        var _tests = null;

        async function init() {
            let myHeaders = new Headers();
            myHeaders.append('Content-Type', 'application/json');
            let pageGet = '/api/tests';
            let response = await fetch(pageGet,
                {
                    headers: myHeaders,
                    method: 'GET'
                });

            let txt = await response.text();
            _tests = JSON.parse(txt);
            console.log(_tests);

            let html = format(_tests);
            document.getElementById('content').innerHTML = html;
            registerOnClicks();

        }

        init();

        async function call(callObj) {
            let myHeaders = new Headers();
            myHeaders.append('Content-Type', 'application/json');
            let response = await fetch('/api/call',
                {
                    headers: myHeaders,
                    method: 'POST',
                    body: JSON.stringify(callObj)
                });

            return await response.json();

        }

        function format(tests) {
            let html = '<ul>';
            tests.forEach((t, i) =>
                html += li(`<a class="test-link" href="tests/${t.Type}/${t.TestName}" data-i="${i}">${t.TestName}</a>`)
            );

            html += '</ul>';
            return html;
        }

        function registerOnClicks() {
            document.querySelectorAll('.test-link').forEach(e => {
                e.addEventListener('click', async (evt) => {
                    evt.preventDefault();

                    let myHeaders = new Headers();
                    myHeaders.append('Content-Type', 'application/json');
                    let response = await fetch('/api/' + e.getAttribute('href'),
                        {
                            headers: myHeaders,
                            method: 'GET',
                            //body: JSON.stringify(callObj)
                        });

                    return await response.json();
                    return false;
                });
            });
        }

        function li(h) {
            return '<li>' + h + '</li>';
        }

    </script>
</body>

</html>